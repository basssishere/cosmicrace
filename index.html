<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cosmic Race - Landscape IFP Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap');

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #050b1a;
            color: white;
            margin: 0;
            overflow: hidden;
            user-select: none;
            touch-action: none;
            height: 100vh;
            width: 100vw;
        }

        .space-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle var(--duration) infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        #welcome-screen {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: linear-gradient(135deg, #050b1a 0%, #1e1b4b 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }

        .astronaut-container {
            width: 200px;
            height: 200px;
            margin-bottom: -20px;
            animation: float 4s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .game-title {
            font-family: 'Fredoka One', cursive;
            font-size: clamp(3rem, 10vw, 6rem);
            background: linear-gradient(to bottom, #fff 30%, #60a5fa 70%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
            animation: titlePulse 2s ease-in-out infinite alternate;
        }

        @keyframes titlePulse { from { transform: scale(1); } to { transform: scale(1.05); } }

        .game-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            padding: 10px;
            gap: 10px;
        }

        .player-zone {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            padding: 12px;
            gap: 8px;
            border: 2px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }

        .orbit-track-horizontal {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
            background: rgba(0,0,0,0.4);
            border-radius: 40px;
            padding: 0 20px;
            flex: 1;
            border: 1px solid rgba(255,255,255,0.1);
            gap: 15px;
        }

        .sun-mini {
            width: clamp(60px, 8vw, 90px);
            height: clamp(60px, 8vw, 90px);
            background: radial-gradient(circle, #fffa81 0%, #ff9d00 60%, #ff5e00 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px #ff9d00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            animation: sunPulse 3s ease-in-out infinite;
            flex-shrink: 0;
        }

        .slot {
            flex: 1;
            max-width: 110px;
            height: 85%;
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
            touch-action: none;
        }

        .slot.has-planet { border-style: solid; border-color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.03); }
        .slot.is-correct { border-color: #4ade80; box-shadow: 0 0 15px rgba(74, 222, 128, 0.4); background: rgba(74, 222, 128, 0.08); }

        .planet-inventory-bottom {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 15px;
            background: rgba(255,255,255,0.03);
            padding: 8px;
            border-radius: 20px;
            height: 95px;
            align-items: center;
        }

        .planet-card {
            cursor: grab;
            touch-action: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s;
            z-index: 10;
            width: 80px;
        }

        .planet-svg { 
            width: 58px; height: 58px; 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
            pointer-events: none;
        }

        .rotate-anim { animation: rotatePlanet 15s linear infinite; }
        @keyframes rotatePlanet { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        @keyframes sunPulse {
            0%, 100% { transform: scale(1) rotate(0deg); box-shadow: 0 0 30px #ff9d00; }
            50% { transform: scale(1.1) rotate(5deg); box-shadow: 0 0 45px #ff5e00; }
        }

        .btn-start {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            padding: 12px 50px;
            border-radius: 50px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            transition: all 0.3s;
        }

        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.15);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            backdrop-filter: blur(10px);
            font-size: 1.2rem;
        }

        .dragging-clone {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            transform: scale(1.3);
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6));
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .invisible { opacity: 0; }
    </style>
</head>
<body>

<div class="space-bg" id="stars-container"></div>

<div id="welcome-screen">
    <div class="astronaut-container">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M30 40 Q30 20 50 20 Q70 20 70 40 L70 60 Q70 80 50 80 Q30 80 30 60 Z" fill="#ffffff" />
            <path d="M35 45 Q35 35 50 35 Q65 35 65 45 L65 55 Q65 65 50 65 Q35 65 35 55 Z" fill="#334155" />
            <rect x="35" y="75" width="30" height="20" rx="5" fill="#ffffff" />
            <path d="M35 80 Q20 80 20 90" stroke="#ffffff" stroke-width="8" stroke-linecap="round" fill="none" />
            <path d="M65 80 Q80 80 80 90" stroke="#ffffff" stroke-width="8" stroke-linecap="round" fill="none" />
            <line x1="50" y1="20" x2="50" y2="10" stroke="#ffffff" stroke-width="2" />
            <circle cx="50" cy="8" r="3" fill="#ef4444" />
        </svg>
    </div>

    <div class="game-title mb-2">COSMIC RACE</div>
    <div class="text-blue-300 font-bold tracking-[0.5em] mb-1 text-lg text-center">MISI TATA SURYA</div>
    <div class="text-white/50 text-xs mb-6 font-bold tracking-widest uppercase">Dibuat oleh basssishere</div>
    
    <div class="bg-black/40 backdrop-blur-xl p-6 rounded-[35px] border border-white/10 text-center max-w-4xl w-[80%]">
        <h2 class="text-lg mb-6 font-bold text-white/80 text-balance">Seret planet ke orbit yang benar secepat mungkin!</h2>
        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <input type="text" id="name1" class="bg-white/10 border-2 border-blue-400 p-3 rounded-2xl w-52 text-center text-lg outline-none focus:bg-white/20 transition-all" value="ASTRONOT 1">
            <input type="text" id="name2" class="bg-white/10 border-2 border-pink-400 p-3 rounded-2xl w-52 text-center text-lg outline-none focus:bg-white/20 transition-all" value="ASTRONOT 2">
        </div>
        <button class="btn-start" id="btn-launch">MULAI BALAPAN! üöÄ</button>
    </div>
</div>

<div class="game-container" id="game-main">
    
    <!-- Player 1 -->
    <div class="player-zone" id="player1">
        <div class="player-header">
            <div class="flex flex-col">
                <div class="text-blue-400 font-bold text-xl drop-shadow-lg" id="display-name1">ASTRONOT 1</div>
                <div id="p1-status" class="text-green-400 text-xs font-bold opacity-0 transition-opacity">‚ú® SEMPURNA! ‚ú®</div>
            </div>
            <div id="p1-score" class="bg-blue-500/20 px-4 py-1 rounded-full text-lg font-bold border border-blue-500/30">0 / 8</div>
        </div>
        
        <div class="orbit-track-horizontal" id="p1-track">
            <div class="sun-mini">‚òÄÔ∏è</div>
            <div class="slot" data-slot-idx="0"></div>
            <div class="slot" data-slot-idx="1"></div>
            <div class="slot" data-slot-idx="2"></div>
            <div class="slot" data-slot-idx="3"></div>
            <div class="slot" data-slot-idx="4"></div>
            <div class="slot" data-slot-idx="5"></div>
            <div class="slot" data-slot-idx="6"></div>
            <div class="slot" data-slot-idx="7"></div>
        </div>
        <div class="planet-inventory-bottom" id="p1-inventory"></div>
    </div>

    <!-- Player 2 -->
    <div class="player-zone" id="player2">
        <div class="player-header">
            <div class="flex flex-col">
                <div class="text-pink-400 font-bold text-xl drop-shadow-lg" id="display-name2">ASTRONOT 2</div>
                <div id="p2-status" class="text-green-400 text-xs font-bold opacity-0 transition-opacity">‚ú® SEMPURNA! ‚ú®</div>
            </div>
            <div id="p2-score" class="bg-pink-500/20 px-4 py-1 rounded-full text-lg font-bold border border-pink-500/30">0 / 8</div>
        </div>
        
        <div class="orbit-track-horizontal" id="p2-track">
            <div class="sun-mini">‚òÄÔ∏è</div>
            <div class="slot" data-slot-idx="0"></div>
            <div class="slot" data-slot-idx="1"></div>
            <div class="slot" data-slot-idx="2"></div>
            <div class="slot" data-slot-idx="3"></div>
            <div class="slot" data-slot-idx="4"></div>
            <div class="slot" data-slot-idx="5"></div>
            <div class="slot" data-slot-idx="6"></div>
            <div class="slot" data-slot-idx="7"></div>
        </div>
        <div class="planet-inventory-bottom" id="p2-inventory"></div>
    </div>

</div>

<div id="win-overlay" class="fixed inset-0 z-[2000] bg-black/95 hidden flex-col items-center justify-center text-center">
    <div class="text-9xl mb-6 animate-bounce">üèÜ</div>
    <h1 id="win-text" class="text-6xl font-bold mb-4">MISI SELESAI!</h1>
    <button class="btn-start" onclick="location.reload()">MAIN LAGI üîÑ</button>
</div>

<div class="audio-control" onclick="toggleAudio()" id="audio-btn">üîá</div>

<script>
    const PLANETS = [
        { name: 'Merkurius', color: '#A5A5A5', size: 20, id: 0 },
        { name: 'Venus', color: '#E3BB76', size: 26, id: 1 },
        { name: 'Bumi', color: '#2271B3', size: 28, id: 2 },
        { name: 'Mars', color: '#E27B58', size: 22, id: 3 },
        { name: 'Jupiter', color: '#D39C7E', size: 42, id: 4 },
        { name: 'Saturnus', color: '#C5AB6E', size: 38, hasRing: true, id: 5 },
        { name: 'Uranus', color: '#BBE1E4', size: 34, id: 6 },
        { name: 'Neptunus', color: '#6081FF', size: 32, id: 7 }
    ];

    let audioCtx, isAudioOn = false, musicInterval, step = 0;
    let playerState = {
        player1: { slots: new Array(8).fill(null) },
        player2: { slots: new Array(8).fill(null) }
    };

    function initAudio() { 
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
    }

    function playCheer() {
        if (!isAudioOn || !audioCtx) return;
        const duration = 2.5;
        const bufferSize = audioCtx.sampleRate * duration;
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) { data[i] = Math.random() * 2 - 1; }
        const noise = audioCtx.createBufferSource();
        noise.buffer = buffer;
        const filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass'; filter.frequency.value = 1200; filter.Q.value = 1;
        const gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.2);
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        noise.connect(filter); filter.connect(gainNode); gainNode.connect(audioCtx.destination);
        noise.start();
    }

    function playNote(freq, type, dur, vol = 0.05) {
        if (!isAudioOn || !audioCtx) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type;
        o.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(vol, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + dur);
    }

    function toggleAudio() {
        initAudio();
        isAudioOn = !isAudioOn;
        document.getElementById('audio-btn').innerText = isAudioOn ? 'üîä' : 'üîá';
        if (isAudioOn) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const melody = [392, 0, 440, 0, 493.88, 523.25, 0, 587.33, 0, 523.25, 0, 493.88, 440, 0, 392, 0, 523.25, 523.25, 0, 587.33, 659.25, 0, 587.33, 0, 392, 440, 493.88, 523.25, 587.33, 0, 783.99, 0];
            const bass = [196, 146, 174, 130, 196, 146, 174, 130];
            musicInterval = setInterval(() => {
                if (step % 4 === 0) playNote(bass[(step/4) % bass.length], 'square', 0.5, 0.02);
                const note = melody[step % melody.length];
                if (note > 0) playNote(note, 'triangle', 0.2, 0.03);
                step++;
            }, 180);
        } else { clearInterval(musicInterval); }
    }

    function createPlanetSVG(planet, animate = false) {
        let svg = `<svg viewBox="0 0 100 100" class="planet-svg">`;
        svg += `<g class="${animate ? 'rotate-anim' : ''}" style="transform-origin: 50% 50%;">`;
        if (planet.hasRing) svg += `<ellipse cx="50" cy="50" rx="46" ry="14" fill="none" stroke="#E3E3E3" stroke-width="2.5" transform="rotate(-20 50 50)" opacity="0.6"/>`;
        svg += `<circle cx="50" cy="50" r="${planet.size}" fill="${planet.color}" />`;
        svg += `<circle cx="40" cy="35" r="${planet.size/3}" fill="white" opacity="0.2" />`;
        svg += `</g></svg>`;
        return svg;
    }

    function getPlanetContentHTML(planet, animate = false) {
        return createPlanetSVG(planet, animate) + `<span class="text-[9px] font-bold mt-1 text-white/90 text-center leading-none">${planet.name}</span>`;
    }

    function startGame() {
        initAudio();
        if (!isAudioOn) toggleAudio();
        document.getElementById('display-name1').innerText = document.getElementById('name1').value.toUpperCase() || "ASTRONOT 1";
        document.getElementById('display-name2').innerText = document.getElementById('name2').value.toUpperCase() || "ASTRONOT 2";
        document.getElementById('welcome-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('game-main').style.display = 'flex';
        }, 500);
        initPlayer('player1', 'p1-inventory');
        initPlayer('player2', 'p2-inventory');
    }

    function initPlayer(pId, invId) {
        const inv = document.getElementById(invId);
        inv.innerHTML = '';
        [...PLANETS].sort(() => Math.random() - 0.5).forEach(p => { createPlanetCard(p, inv, pId); });
        const slots = document.querySelectorAll(`#${pId} .slot`);
        slots.forEach(slot => { slot.addEventListener('pointerdown', handleSlotPointerDown); });
    }

    function createPlanetCard(planet, container, pId) {
        const card = document.createElement('div');
        card.className = 'planet-card';
        card.innerHTML = getPlanetContentHTML(planet);
        card.dataset.id = planet.id;
        card.dataset.pId = pId;
        card.addEventListener('pointerdown', handleInventoryPointerDown);
        container.appendChild(card);
    }

    function handleInventoryPointerDown(e) {
        const card = e.currentTarget;
        const pId = card.dataset.pId;
        const planetId = card.dataset.id;
        startDragging(e, card, pId, planetId, true);
    }

    function handleSlotPointerDown(e) {
        const slot = e.currentTarget;
        const pId = slot.closest('.player-zone').id;
        const slotIdx = parseInt(slot.dataset.slotIdx);
        const planetId = playerState[pId].slots[slotIdx];
        if (planetId !== null) {
            playerState[pId].slots[slotIdx] = null;
            slot.innerHTML = '';
            slot.classList.remove('has-planet', 'is-correct');
            const dummy = document.createElement('div');
            dummy.innerHTML = getPlanetContentHTML(PLANETS[planetId]);
            dummy.className = 'planet-card';
            startDragging(e, dummy, pId, planetId, false);
            checkSequence(pId);
        }
    }

    function startDragging(e, sourceEl, pId, planetId, isFromInventory) {
        try { sourceEl.setPointerCapture(e.pointerId); } catch (err) { document.body.setPointerCapture(e.pointerId); }
        const clone = document.createElement('div');
        clone.innerHTML = getPlanetContentHTML(PLANETS[planetId]);
        clone.className = 'dragging-clone';
        clone.style.width = '70px';
        clone.style.left = (e.clientX - 35) + 'px';
        clone.style.top = (e.clientY - 35) + 'px';
        document.body.appendChild(clone);
        if (isFromInventory) sourceEl.classList.add('invisible');
        const move = (pe) => { clone.style.left = (pe.clientX - 35) + 'px'; clone.style.top = (pe.clientY - 35) + 'px'; };
        const up = (pe) => {
            try {
                if (isFromInventory) sourceEl.releasePointerCapture(pe.pointerId);
                else document.body.releasePointerCapture(pe.pointerId);
            } catch(e) {}
            window.removeEventListener('pointermove', move);
            window.removeEventListener('pointerup', up);
            if (document.body.contains(clone)) document.body.removeChild(clone);
            const dropTarget = document.elementFromPoint(pe.clientX, pe.clientY);
            const slot = dropTarget ? dropTarget.closest('.slot') : null;
            if (slot && slot.closest('.player-zone').id === pId) {
                const targetSlotIdx = parseInt(slot.dataset.slotIdx);
                if (playerState[pId].slots[targetSlotIdx] !== null) {
                    const prevId = playerState[pId].slots[targetSlotIdx];
                    createPlanetCard(PLANETS[prevId], document.getElementById(pId === 'player1' ? 'p1-inventory' : 'p2-inventory'), pId);
                }
                playerState[pId].slots[targetSlotIdx] = parseInt(planetId);
                slot.innerHTML = getPlanetContentHTML(PLANETS[planetId], true);
                slot.classList.add('has-planet');
                if (isFromInventory) sourceEl.remove();
                playNote(880, 'sine', 0.1, 0.04);
            } else {
                createPlanetCard(PLANETS[planetId], document.getElementById(pId === 'player1' ? 'p1-inventory' : 'p2-inventory'), pId);
                if (isFromInventory) sourceEl.remove();
            }
            checkSequence(pId);
        };
        window.addEventListener('pointermove', move);
        window.addEventListener('pointerup', up);
    }

    function checkSequence(pId) {
        const slots = playerState[pId].slots;
        let correctCount = 0;
        const slotEls = document.querySelectorAll(`#${pId} .slot`);
        slots.forEach((pIdx, idx) => {
            if (pIdx !== null && pIdx === idx) {
                correctCount++;
                slotEls[idx].classList.add('is-correct');
            } else {
                slotEls[idx].classList.remove('is-correct');
            }
        });
        document.getElementById(pId === 'player1' ? 'p1-score' : 'p2-score').innerText = `${correctCount} / 8`;
        if (correctCount === 8) {
            document.getElementById(pId === 'player1' ? 'p1-status' : 'p2-status').style.opacity = '1';
            playCheer();
            [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playNote(f, 'sine', 0.6, 0.08), i * 120));
            setTimeout(() => {
                const winnerName = document.getElementById(pId === 'player1' ? 'display-name1' : 'display-name2').innerText;
                document.getElementById('win-text').innerText = winnerName + " MENANG!";
                document.getElementById('win-overlay').style.display = 'flex';
            }, 1200);
        }
    }

    document.getElementById('btn-launch').addEventListener('click', startGame);
    const sc = document.getElementById('stars-container');
    for(let i=0; i<120; i++) {
        let s = document.createElement('div'); s.className='star';
        s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%';
        s.style.width=s.style.height=Math.random()*2.5+'px';
        s.style.setProperty('--duration', Math.random()*3+2+'s');
        sc.appendChild(s);
    }
</script>
</body>
</html>
